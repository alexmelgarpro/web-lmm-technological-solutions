<!DOCTYPE html>
<html lang="es">

<head>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!---Bootstrap css yo--->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">



	<title>Proyecto</title>

  <!-- 
    - favicon
  -->
  <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">

  <!-- 
    - custom css link
  -->
  <link rel="stylesheet" href="./assets/css/style.css">

  <!-- 
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500&family=Poppins:wght@600;700&family=Rubik:wght@400;500&display=swap"
    rel="stylesheet">
</head>
<body id="top">

	<!-- 
    - #HEADER
  -->

  <header class="header" data-header>
    <div class="container">

      <div class="overlay" data-overlay></div>

      <a href="#" class="logo">
        <img src="./assets/images/logo.png" alt="Eduland logo">
      </a>

      <button class="menu-open-btn" data-menu-open-btn>
        <ion-icon name="menu-outline"></ion-icon>
      </button>

      <nav class="navbar" data-navbar>

        <button class="menu-close-btn" data-menu-close-btn>
          <ion-icon name="close-outline"></ion-icon>
        </button>

        <a href="#" class="logo">
          <img src="./assets/images/logo.png" alt="">
        </a>

        <ul class="navbar-list">

          <li>
            <a href="index.html" class="navbar-link">Inicio</a>
          </li>

          <li>
            <a href="Equipo.html" class="navbar-link">Equipo</a>
          </li>

          <li>
            <a href="Proyecto.html" class="navbar-link">Proyecto</a>
          </li>

          <li>
            <a href="Materiales.html" class="navbar-link">Materiales</a>
          </li>

          <li>
            <a href="Contacto.html" class="navbar-link">Contacto</a>
          </li>

        </ul>

        <button class="btn btn-secondary">Empezemos</button>

      </nav>

    </div>
  </header>
  

  <br>
  <br>
  <br>
  <br>
  <br>

  <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="false">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="assets/images/carrusel-proyecto/proyecto1.png" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        
      </div>
    </div>
    <div class="carousel-item">
      <img src="assets/images/carrusel-proyecto/proyecto2.png" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        
      </div>
    </div>
    <div class="carousel-item">
      <img src="assets/images/carrusel-proyecto/proyecto3.png" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>


<main>
    <article>

      <!-- 
        - #HERO
      -->

      <section class="hero">
        <div class="container">

          <figure class="hero-banner">
            <img src="./assets/images/imgProyecto/esp32CAM.png" alt="" height="650">
            <center><p>Imagen Real</p></center>
          </figure>

          <div class="hero-content">

            <h1 class="h1 hero-title">Cámara de seguridad con sensor de movimiento</h1>

            <p class="section-text">
              Un detector de movimiento es un dispositivo electrónico equipado de sensores que responden a un movimiento físico. Se encuentran, generalmente, en sistemas de seguridad o en circuitos cerrados de televisión. El sistema puede estar compuesto, simplemente, por una cámara de vigilancia conectada a un ordenador, que se encarga de generar una señal de alarma o poner el sistema en estado de alerta cuando algo se mueve.

              En la actualidad hay diferentes tipos de sistemas de alarmas para el hogar disponibles en el mercado, los cuales varían en el nivel de protección que ofrecen la o las empresas que los proporcionan.

            </p>

          </div>

        </div>
      </section>

      <!-- 
        - #ABOUT
      -->

      <section class="about">
        <div class="container">

          <figure class="about-banner">
  
            <img src="./assets/images/imgProyecto/objetivo.png" alt="Eduland students" class="about-img">

          </figure>

          <div class="about-content">

            <h2 class="h2 about-title">Objetivo</h2>

            <p class="section-text">
              El objetivo principal del proyecto es crear un sistema de seguridad que integre una cámara, y lograr adaptarlo a un microcontrolador (Esp32 CAM), la cual alerte y mande imágenes cuando hay alguien cerca y así uno pueda realizar sus tareas normalmente sin tener que estar pendiente de la cámara.
              Construirlo desde cero y a su vez adquirir conocimiento sobre sus aplicaciones y adecuaciones a su entorno.
            </p>

          </div>

        </div>
      </section>

      <!-- 
        - #HERO
      -->


      <section class="hero">
        <div class="container">

          <figure class="hero-banner">
            <img src="./assets/images/imgProyecto/solucion.png" alt="A young lady sits, holding a pen and a notebook.">
          </figure>

          <div class="hero-content">

            <h1 class="h1 hero-title">Solucion a la Problematica</h1>

            <p class="section-text">
              Vigilar y proteger tanto a la persona como al inmueble que habita. Las alarmas son de interés especial para los diferentes tipos de personas o puedan encontrarse en otras situaciones, no necesariamente por asalto sino también por necesidades de supervisión por problemas de salud, en las que se requiera avisar para recibir asistencia urgente.
            </p>

          </div>

        </div>
      </section>

      <!-- 
        - #ABOUT
      -->

      <section class="about">
        <div class="container">

          <figure class="about-banner">
  
            <img src="./assets/images/imgProyecto/proyectodiagrama1.png" alt="Eduland students" class="about-img">

          </figure>

          <div class="about-content">

            <h2 class="h2 about-title">Diagrama para conexión a la pc</h2>

            <p class="section-text">
              En este apartado, utilizaremos el esp32cam junto con el adaptador ft232 en la que este adaptador lo utilizaremos para conectar el esp a la computadora para programarlo

            </p>

          </div>

        </div>
      </section>

      <!-- 
        - #HERO
      -->


      <section class="hero">
        <div class="container">

          <figure class="hero-banner">
            <img src="./assets/images/imgProyecto/proyectodiagrama2.png" alt="A young lady sits, holding a pen and a notebook.">
          </figure>

          <div class="hero-content">

            <h1 class="h1 hero-title">Diagrama del proyecto</h1>

            <p class="section-text">
              En este segundo diagrama, veremos que, una vez programado el esp32 se realizara una nueva conexión con la fuente de voltaje y el sensor de movimiento PIR.
            </p>

          </div>

        </div>
      </section>

      <!-- 
        - #ABOUT
      -->

      <section class="about">
        <div class="container">

          <figure class="about-banner">
  
            <img src="./assets/images/imgProyecto/funcionamiento.png" alt="Eduland students" class="about-img">

          </figure>

          <div class="about-content">

            <h2 class="h2 about-title">Funcionamiento</h2>

            <p class="section-text">
              Nuestro proyecto es una cámara con un sensor de movimiento en la que cada ves que detecte movimiento la cámara empezara a tomar imágenes alertándonos y enviándonos imágenes mediante Telegram.

            </p>

          </div>

        </div>
      </section>
	    
	<section class="hero">
        <div class="container">

          <figure class="hero-banner">
            <img src="./assets/images/imgProyecto/img de ti2.jpg" alt="" height="650">
            <center><p>Imagen Real</p></center>
          </figure>

          <div class="hero-content">

            <h1 class="h1 hero-title">Estructura del Proyecto</h1>

            <p class="section-text">
              Un detector de movimiento es un dispositivo electrónico equipado de sensores que responden a un movimiento físico.

            </p>

          </div>

        </div>
      </section>
	    
	<section class="about">
        <div class="container">

          <figure class="about-banner">
  
            <img src="" alt="Eduland students" class="about-img">

          </figure>

          <div class="about-content">

            <h2 class="h2 about-title">Codigo del Proyecto</h2>

            <p class="section-text">
             
		    
#include <WiFi.h>
#include <WiFiClientSecure.h>
#include "soc/soc.h"
#include "soc/rtc_cntl_reg.h"
#include "esp_camera.h"
#include <UniversalTelegramBot.h>
#include <ArduinoJson.h>
#include <Wire.h>
#include <avr/io.h>
#include <DmxMaster.h>

// Replace with your network credentials
const char* ssid = "robert65 2.4Ghz";
const char* password = "cholines2803#";

// Use @myidbot to find out the chat ID of an individual or a group
// Also note that you need to click "start" on a bot before it can
// message you
String chatId = "TU-CHATID";

// Initialize Telegram BOT
String BOTtoken = "TU-TOKEN-TELEGRAM";

bool sendPhoto = false;

WiFiClientSecure clientTCP;

UniversalTelegramBot bot(BOTtoken, clientTCP);

//CAMERA_MODEL_AI_THINKER
#define PWDN_GPIO_NUM     32
#define RESET_GPIO_NUM    -1
#define XCLK_GPIO_NUM      0
#define SIOD_GPIO_NUM     26
#define SIOC_GPIO_NUM     27

#define Y9_GPIO_NUM       35
#define Y8_GPIO_NUM       34
#define Y7_GPIO_NUM       39
#define Y6_GPIO_NUM       36
#define Y5_GPIO_NUM       21
#define Y4_GPIO_NUM       19
#define Y3_GPIO_NUM       18
#define Y2_GPIO_NUM        5
#define VSYNC_GPIO_NUM    25
#define HREF_GPIO_NUM     23
#define PCLK_GPIO_NUM     22

#define FLASH_LED_PIN 4
bool flashState = LOW;

// Motion Sensor
bool motionDetected = false;
const int motionSensor = GPIO_NUM_13; // PIR Motion Sensor
 
int botRequestDelay = 1000;   // mean time between scan messages
long lastTimeBotRan;     // last time messages' scan has been done

void handleNewMessages(int numNewMessages);
String sendPhotoTelegram();

// Indicates when motion is detected
static void IRAM_ATTR detectsMovement(){
  //Serial.println("MOTION DETECTED!!!");
  motionDetected = true;
}

void setup(){
  WRITE_PERI_REG(RTC_CNTL_BROWN_OUT_REG, 0); 
  Serial.begin(115200);

  pinMode(motionSensor, INPUT_PULLUP);
  // Set motionSensor pin as interrupt, assign interrupt function and set RISING mode
  attachInterrupt(digitalPinToInterrupt(motionSensor), detectsMovement, RISING);

  pinMode(FLASH_LED_PIN, OUTPUT);
  digitalWrite(FLASH_LED_PIN, flashState);
  
  WiFi.mode(WIFI_STA);
  Serial.println();
  Serial.print("Connecting to ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  clientTCP.setCACert(TELEGRAM_CERTIFICATE_ROOT); // Add root certificate for api.telegram.org
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(500);
  }
  Serial.println();
  Serial.print("ESP32-CAM IP Address: ");
  Serial.println(WiFi.localIP());

  camera_config_t config;
  config.ledc_channel = LEDC_CHANNEL_0;
  config.ledc_timer = LEDC_TIMER_0;
  config.pin_d0 = Y2_GPIO_NUM;
  config.pin_d1 = Y3_GPIO_NUM;
  config.pin_d2 = Y4_GPIO_NUM;
  config.pin_d3 = Y5_GPIO_NUM;
  config.pin_d4 = Y6_GPIO_NUM;
  config.pin_d5 = Y7_GPIO_NUM;
  config.pin_d6 = Y8_GPIO_NUM;
  config.pin_d7 = Y9_GPIO_NUM;
  config.pin_xclk = XCLK_GPIO_NUM;
  config.pin_pclk = PCLK_GPIO_NUM;
  config.pin_vsync = VSYNC_GPIO_NUM;
  config.pin_href = HREF_GPIO_NUM;
  config.pin_sscb_sda = SIOD_GPIO_NUM;
  config.pin_sscb_scl = SIOC_GPIO_NUM;
  config.pin_pwdn = PWDN_GPIO_NUM;
  config.pin_reset = RESET_GPIO_NUM;
  config.xclk_freq_hz = 20000000;
  config.pixel_format = PIXFORMAT_JPEG;

  //init with high specs to pre-allocate larger buffers
  if(psramFound()){
    config.frame_size = FRAMESIZE_UXGA;
    config.jpeg_quality = 10;  //0-63 lower number means higher quality
    config.fb_count = 2;
  } else {
    config.frame_size = FRAMESIZE_SVGA;
    config.jpeg_quality = 12;  //0-63 lower number means higher quality
    config.fb_count = 1;
  }
  
  // camera init
  esp_err_t err = esp_camera_init(&config);
  if (err != ESP_OK) {
    Serial.printf("Camera init failed with error 0x%x", err);
    delay(1000);
    ESP.restart();
  }

  // Drop down frame size for higher initial frame rate
  sensor_t * s = esp_camera_sensor_get();
  s->set_framesize(s, FRAMESIZE_CIF);  // UXGA|SXGA|XGA|SVGA|VGA|CIF|QVGA|HQVGA|QQVGA
}

void loop(){
  if (sendPhoto){
    sendPhotoTelegram(); 
    sendPhoto = false; 
  }

  if(motionDetected){
    bot.sendMessage(chatId, "Movimiento detectado!!", "");
    sendPhotoTelegram();
    motionDetected = false;
  }
  
  if (millis() > lastTimeBotRan + botRequestDelay){
    int numNewMessages = bot.getUpdates(bot.last_message_received + 1);
    while (numNewMessages){
      handleNewMessages(numNewMessages);
      numNewMessages = bot.getUpdates(bot.last_message_received + 1);
    }
    lastTimeBotRan = millis();
  }
}

String sendPhotoTelegram(){
  const char* myDomain = "api.telegram.org";
  String getAll = "";
  String getBody = "";

  camera_fb_t * fb = NULL;
  fb = esp_camera_fb_get();  
  if(!fb) {
    Serial.println("Camera capture failed");
    delay(1000);
    ESP.restart();
    return "Camera capture failed";
  }  
  
  Serial.println("Connect to " + String(myDomain));

  if (clientTCP.connect(myDomain, 443)) {
    Serial.println("Conexión exitosa");
    
    String head = "--ElectronicaDeUna\r\nContent-Disposition: form-data; name=\"chat_id\"; \r\n\r\n" + chatId + "\r\n--ElectronicaDeUna\r\nContent-Disposition: form-data; name=\"photo\"; filename=\"esp32-cam.jpg\"\r\nContent-Type: image/jpeg\r\n\r\n";
    String tail = "\r\n--ElectronicaDeUna--\r\n";

    uint16_t imageLen = fb->len;
    uint16_t extraLen = head.length() + tail.length();
    uint16_t totalLen = imageLen + extraLen;
  
    clientTCP.println("POST /bot"+BOTtoken+"/sendPhoto HTTP/1.1");
    clientTCP.println("Host: " + String(myDomain));
    clientTCP.println("Content-Length: " + String(totalLen));
    clientTCP.println("Content-Type: multipart/form-data; boundary=ElectronicaDeUna");
    clientTCP.println();
    clientTCP.print(head);
  
    uint8_t *fbBuf = fb->buf;
    size_t fbLen = fb->len;
    for (size_t n=0;n<fbLen;n=n+1024) {
      if (n+1024<fbLen) {
        clientTCP.write(fbBuf, 1024);
        fbBuf += 1024;
      }
      else if (fbLen%1024>0) {
        size_t remainder = fbLen%1024;
        clientTCP.write(fbBuf, remainder);
      }
    }  
    
    clientTCP.print(tail);
    
    esp_camera_fb_return(fb);
    
    int waitTime = 10000;   // timeout 10 seconds
    long startTimer = millis();
    boolean state = false;
    
    while ((startTimer + waitTime) > millis()){
      Serial.print(".");
      delay(100);      
      while (clientTCP.available()) {
        char c = clientTCP.read();
        if (state==true) getBody += String(c);        
        if (c == '\n') {
          if (getAll.length()==0) state=true; 
          getAll = "";
        } 
        else if (c != '\r')
          getAll += String(c);
        startTimer = millis();
      }
      if (getBody.length()>0) break;
    }
    clientTCP.stop();
    Serial.println(getBody);
  }
  else {
    getBody="Connected to api.telegram.org failed.";
    Serial.println("Connected to api.telegram.org failed.");
  }
  return getBody;
}

void handleNewMessages(int numNewMessages){
  Serial.print("Handle New Messages: ");
  Serial.println(numNewMessages);

  for (int i = 0; i < numNewMessages; i++){
    // Chat id of the requester
    String chat_id = String(bot.messages[i].chat_id);
    if (chat_id != chatId){
      bot.sendMessage(chat_id, "Usuario no autorizado", "");
      continue;
    }
    
    // Print the received message
    String text = bot.messages[i].text;
    Serial.println(text);

    String fromName = bot.messages[i].from_name;

    if (text == "/flash") {
      flashState = !flashState;
      digitalWrite(FLASH_LED_PIN, flashState);
    }
    if (text == "/foto") {
      sendPhoto = true;
    }
    if (text == "/start"){
      String welcome = "Bienvenido al bot de Telegram del ESP32-CAM.\n";
      welcome += "/foto : toma una nueva foto\n";
      welcome += "Recibirás una foto cuando se detecte movimiento.\n";
      bot.sendMessage(chatId, welcome, "Markdown");
    }
  }
}
		    

            </p>

          </div>

        </div>
      </section>

      

      </article>
  </main>












<!-- 
    - #FOOTER
  -->

  <footer class="footer">

    <div class="footer-top">
      <div class="container">

        <div class="footer-brand">

          <a href="#" class="logo">
            <img src="./assets/images/logo.png" alt="Eduland logo">
          </a>

          <p class="footer-text">
            Escale profesionalmente el capital humano multifuncional y la tecnología extensiva.
          </p>

          <ul class="social-list">

            <li>
              <a href="#" class="social-link">
                <ion-icon name="logo-google"></ion-icon>
              </a>
            </li>

            <li>
              <a href="#" class="social-link">
                <ion-icon name="logo-twitter"></ion-icon>
              </a>
            </li>

            <li>
              <a href="#" class="social-link">
                <ion-icon name="logo-instagram"></ion-icon>
              </a>
            </li>

            <li>
              <a href="#" class="social-link">
                <ion-icon name="logo-linkedin"></ion-icon>
              </a>
            </li>

          </ul>

        </div>

        

          <ul class="footer-list">

            <li>
              <p class="footer-link-title">Contacto</p>
            </li>

            <li class="contact-item">
              <span>Telefono : </span>

              <a href="tel:974696011" class="contact-link">974696011</a>
            </li>

            <li class="contact-item">
              <span>Correo : </span>

              <a href="mailto:example@gmail.com" class="contact-link">marcelo_panduro@usmp.pe</a>
            </li>

            <li class="contact-item">
              <span>Dirección : </span>

              <a href="#" class="contact-link">
                <address>Lima - Peru</address>
              </a>
            </li>

          </ul>

        </div>

      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <p class="copyright">
          &copy; 2022 <a href="">LMM - Soluciones Tecnológicas</a>. Todos los derechos reservados
        </p>
      </div>
    </div>

  </footer>




  <!-- 
    - #GO TO TOP
  -->

  <a href="#top" class="go-top" data-go-top>
    <ion-icon name="arrow-up"></ion-icon>
  </a>



    <!-- 
      - custom js link
    -->
    <script src="./assets/js/script.js"></script>

    <!-- 
      - ionicon link
    -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>


    <!---Bootstrap opcion 1 popers yo--->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>



</body>
</html>
